# Gemba Agent 2.0 - 快速开始指南

## 🚀 一键启动

```bash
# 安装依赖
cd scripts/gemba-agent-v2
npm install

# 启动Gemba Agent（自动模式）
npm start

# 或使用具体命令
npm run gemba          # 完整自动模式
npm run gemba:dry      # 模拟运行（不执行实际修改）
npm run gemba:manual   # 手动模式（需要确认每个决策）
```

## 📊 核心功能

### 1. 👁️ 感知层（Perception Layer）
- **浏览器自动化**: 使用Playwright进行UI测试和监控
- **性能监控**: 实时采集FCP、LCP、TTI等核心指标
- **错误检测**: 自动捕获Console错误、网络错误、页面崩溃
- **文件监控**: 监视代码变更，识别热点文件
- **视觉回归**: 截图对比，检测UI变化

### 2. 🧠 决策层（Decision Layer）
- **模式识别**: 从历史数据中学习成功/失败模式
- **智能决策**: 基于置信度和风险评估做出决策
- **A/B测试**: 自动创建和管理优化实验
- **持续学习**: 从每个决策的结果中学习和改进
- **知识库**: 积累最佳实践和反模式

### 3. 🦾 执行层（Execution Layer）
- **自动修复**: 自动修复简单错误（类型检查、语法等）
- **测试生成**: 自动生成缺失的测试用例
- **性能优化**: 实施代码分割、懒加载等优化
- **重构执行**: 自动模块化和代码重构
- **文档生成**: 自动生成API文档、用户指南

## 🎯 使用场景

### 场景1: 持续监控和自动修复
```javascript
// Agent会自动：
// 1. 监控localhost:8080
// 2. 检测错误和性能问题
// 3. 自动修复简单问题
// 4. 生成修复报告
```

### 场景2: 代码变更后的智能测试
```javascript
// 当检测到关键文件变更时：
// 1. 自动识别影响范围
// 2. 运行相关测试
// 3. 生成缺失的测试
// 4. 报告测试覆盖率
```

### 场景3: 性能优化建议
```javascript
// Agent会：
// 1. 持续监控性能指标
// 2. 检测性能退化
// 3. 提供优化建议
// 4. 自动实施简单优化
```

## 📈 自我进化机制

### 短期进化（分钟级）
- 实时调整测试策略
- 动态优化执行顺序
- 即时错误模式识别

### 中期进化（小时级）
- 优化决策权重
- 更新知识库
- 调整风险阈值

### 长期进化（天级）
- 架构优化建议
- 技术债务识别
- 团队效率分析

## 🛠️ 配置选项

```javascript
const agent = new GembaAgent({
    // 基础配置
    baseUrl: 'http://localhost:8080',      // 监控的URL
    watchPaths: ['./duomotai', './server'], // 监控的文件路径

    // 模式配置
    autoMode: true,          // 自动执行决策
    learningEnabled: true,   // 启用学习机制
    dryRun: false,          // 模拟模式

    // 阈值配置
    decisionThreshold: 0.7,  // 决策置信度阈值
    maxRetries: 3,          // 最大重试次数

    // 报告配置
    reportInterval: 60000,   // 报告间隔（毫秒）
});
```

## 📊 实时报告

Agent每分钟生成一次报告，包括：
- 运行统计（错误数、决策数、执行数）
- 成功率和学习进度
- 性能趋势分析
- 改进建议
- 实验结果

## 🔍 监控指标

### 效率提升目标
- 问题发现时间：-80%
- 问题修复时间：-60%
- 测试覆盖率：+40%
- 部署成功率：+30%

### 质量提升目标
- Bug逃逸率：-70%
- 性能退化：-50%
- 用户满意度：+25%
- 代码质量分数：+35%

## 💡 最佳实践

1. **开始时使用dry-run模式**
   ```bash
   npm run gemba:dry
   ```
   观察Agent的决策但不执行实际修改

2. **逐步启用功能**
   - 先启用感知层（只监控）
   - 然后启用决策层（生成建议）
   - 最后启用执行层（自动修复）

3. **定期查看学习报告**
   ```bash
   npm run gemba:report
   ```
   了解Agent的学习进度和改进效果

4. **保留人工审核**
   - 高风险决策始终需要人工确认
   - 定期审查Agent的决策日志
   - 及时调整配置参数

## 🚨 注意事项

1. **首次运行**：Agent需要时间学习你的代码模式，初期可能有误判
2. **备份重要文件**：虽然有回滚机制，但建议定期备份
3. **监控资源使用**：Agent运行时会占用一定CPU和内存
4. **网络依赖**：某些功能需要网络连接（如Lighthouse性能测试）

## 📝 日志和数据

所有数据保存在项目根目录下：
- `gemba-patterns.json` - 识别的模式
- `gemba-learning-history.json` - 学习历史
- `gemba-knowledge-base.json` - 知识库
- `gemba-reports/` - 生成的报告
- `gemba-snapshots/` - 视觉快照
- `gemba-videos/` - 录制的视频

## 🎯 下一步

1. **安装并启动Agent**
2. **让它运行1小时**收集基线数据
3. **查看第一份报告**了解项目状态
4. **调整配置**以适应你的项目
5. **启用自动修复**开始真正的自动化

---

**Gemba Agent 2.0** - 不只是测试工具，而是你的智能开发伙伴！ 🚀