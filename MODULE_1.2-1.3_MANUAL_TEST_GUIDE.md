# 🧪 Module 1.2 & 1.3 手工测试指南

**测试模块**: Module 1 - 用户认证与数据管理
**测试子模块**: 1.2 数据验证 + 1.3 用户画像
**创建时间**: 2025-10-18 14:30 (GMT+8)
**测试环境**: http://localhost:8080/duomotai/
**测试账号**: 13917895758（固定验证码 888888）

---

## 📋 测试前准备

### 1. 确认服务状态

✅ **前端服务（8080）**: 已启动
✅ **后端服务（3001）**: 已启动

### 2. 打开测试页面

```
URL: http://localhost:8080/duomotai/
浏览器: Chrome（推荐使用无痕模式，避免缓存干扰）
```

### 3. 登录测试账号

1. 点击"启动风暴辩论"（或刷新页面）
2. 输入手机号：`13917895758`
3. 点击"发送验证码"
4. 输入验证码：`888888`
5. 点击"登录"

---

## 🧪 Module 1.2 - 数据验证测试

### 测试点 1.2.1 - 话题长度验证

**功能位置**: 困境输入框（"请详细描述您面临的困境..."）
**代码位置**: `duomotai/index.html` Line 643-652
**Bug 修复记录**: Bug #1 Fix

#### 场景 A：输入过短（< 20 字符）

**步骤**:
1. 在困境输入框中输入：`测试短文本`（5个字）
2. 点击"启动风暴辩论"按钮

**预期结果**:
- ✅ 弹出警告：`请输入至少20个字的问题，以便AI更好地理解您的需求！`
- ✅ 辩论不启动

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 B：输入合法长度（20-100 字符）

**步骤**:
1. 在困境输入框中输入：
```
我的短视频账号粉丝增长缓慢，近三个月涨粉不足500人，内容更新频率保持在每周3条，但互动率较低。
```
（共 48 个字符，符合 20-100 范围）

2. 点击"启动风暴辩论"按钮

**预期结果**:
- ✅ 无警告弹出
- ✅ 辩论正常启动（进入角色准备阶段）

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 C：输入过长（> 100 字符）

**步骤**:
1. 在困境输入框中输入：
```
我的短视频账号粉丝增长缓慢，近三个月涨粉不足500人，内容更新频率保持在每周3条，但互动率较低，点赞评论转发数据都不理想，我尝试过改变拍摄风格、调整发布时间、增加热点话题标签，但效果都不明显，现在非常迷茫不知道该如何突破这个瓶颈期
```
（共 117 个字符，超过 100）

2. 点击"启动风暴辩论"按钮

**预期结果**:
- ✅ 弹出警告：`问题长度不能超过100个字，请精简您的表述！`
- ✅ 辩论不启动

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 D：边界值测试（恰好 20 和 100 字符）

**步骤 1**: 输入恰好 20 个字符
```
我的短视频账号粉丝增长缓慢，近三个月涨粉不足
```
（恰好 20 个字符）

**预期结果**: ✅ 通过验证，可以启动

**步骤 2**: 输入恰好 100 个字符
```
我的短视频账号粉丝增长缓慢，近三个月涨粉不足500人，内容更新频率保持在每周3条，但互动率较低，点赞评论转发数据都不理想，我尝试过改变拍摄风格、调整发布时间
```
（恰好 100 个字符）

**预期结果**: ✅ 通过验证，可以启动

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

### 测试点 1.2.2 - 邮箱格式验证

**功能位置**: 用户画像调研模态框 → 邮箱输入框
**代码位置**: `duomotai/src/modules/userProfile.js` + 后端API

**前提条件**:
1. 清除浏览器缓存（Ctrl+Shift+Delete）
2. 使用无痕模式
3. 登录测试账号 13917895758

#### 场景 A：标准邮箱格式

**步骤**:
1. 刷新页面，触发用户画像调研弹窗
2. 在邮箱输入框中输入：`test@example.com`
3. 填写其他必填项（年龄段、性别、昵称）
4. 点击"保存"或"提交"

**预期结果**:
- ✅ 邮箱验证通过
- ✅ 画像成功保存
- ✅ 后端返回 success: true

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 B：非法邮箱格式

**步骤**: 尝试输入以下非法邮箱格式，每次测试后刷新页面

| 输入值 | 预期结果 |
|--------|---------|
| `invalid-email` | ❌ 提示格式错误 |
| `missing@at.sign` | ❌ 提示格式错误 |
| `@no-local-part.com` | ❌ 提示格式错误 |
| `no-domain@` | ❌ 提示格式错误 |
| `spaces in@email.com` | ❌ 提示格式错误 |
| `multiple@@at.com` | ❌ 提示格式错误 |

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

### 测试点 1.2.3 - XSS 防护

**功能位置**: 困境输入框 + 背景输入框
**代码位置**: `duomotai/index.html` Line 627-632 (sanitizeInput 函数)
**Bug 修复记录**: Bug #3 Fix

#### 场景 A：脚本标签注入

**步骤**:
1. 在困境输入框中输入：
```html
<script>alert('XSS Attack!')</script>这是我的短视频运营困境，如何提升粉丝增长速度？
```

2. 点击"启动风暴辩论"

**预期结果**:
- ✅ HTML 标签被过滤，实际提交内容：`这是我的短视频运营困境，如何提升粉丝增长速度？`
- ✅ 不弹出 `XSS Attack!` 警告框
- ✅ 辩论正常启动（如果字符数符合 20-100）

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 B：图片标签注入

**步骤**:
1. 在困境输入框中输入：
```html
<img src=x onerror=alert('XSS')>我的短视频账号粉丝增长缓慢，如何突破瓶颈期？
```

2. 点击"启动风暴辩论"

**预期结果**:
- ✅ `<img>` 标签被过滤
- ✅ 不执行 onerror 事件
- ✅ 辩论正常启动

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 C：样式标签注入

**步骤**:
1. 在困境输入框中输入：
```html
<style>body{display:none;}</style>我的短视频账号粉丝增长缓慢，如何提升互动率？
```

2. 点击"启动风暴辩论"

**预期结果**:
- ✅ `<style>` 标签被过滤
- ✅ 页面不消失（body 不会被隐藏）
- ✅ 辩论正常启动

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 D：事件处理器注入

**步骤**:
1. 在困境输入框中输入：
```html
<div onclick="alert('Clicked!')">点击我</div>如何提升短视频的播放量和完播率？
```

2. 点击"启动风暴辩论"

**预期结果**:
- ✅ `<div>` 标签和 onclick 被过滤
- ✅ 实际内容：`点击我如何提升短视频的播放量和完播率？`

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

### 测试点 1.2.4 - SQL 注入防护

**说明**: 前端无 SQL 操作，此测试针对后端 API

**功能位置**: 用户画像保存 API
**API 端点**: `POST http://localhost:3001/api/user/profile`

#### 场景 A：昵称字段 SQL 注入

**步骤**:
1. 打开浏览器 DevTools → Console 标签
2. 执行以下代码（模拟 SQL 注入攻击）：

```javascript
fetch('http://localhost:3001/api/user/profile', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    phone: '13917895758',
    nickname: "'; DROP TABLE users; --",
    email: 'test@example.com',
    ageGroup: '25-35',
    gender: '男'
  })
})
.then(r => r.json())
.then(data => console.log('Response:', data))
```

**预期结果**:
- ✅ 后端正常处理请求（SQL 注入被安全处理）
- ✅ 返回 `{ success: true }` 或安全错误消息
- ✅ **数据库未被破坏**（服务器仍正常运行）

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 B：邮箱字段 SQL 注入

**步骤**:
1. 在 DevTools Console 中执行：

```javascript
fetch('http://localhost:3001/api/user/profile', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    phone: '13917895758',
    nickname: '测试用户',
    email: "admin'--@example.com",
    ageGroup: '25-35',
    gender: '女'
  })
})
.then(r => r.json())
.then(data => console.log('Response:', data))
```

**预期结果**:
- ✅ SQL 特殊字符被转义或拒绝
- ✅ 后端返回安全的错误消息或成功消息
- ✅ 服务器未崩溃

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

## 🧪 Module 1.3 - 用户画像测试

### 测试点 1.3.1 - 画像数据存储

**功能位置**: 用户画像调研模态框
**代码位置**: `duomotai/src/modules/userProfile.js` + `server/routes/userRoutes.js`

#### 场景 A：首次创建用户画像

**步骤**:
1. **清除旧数据**：
   - 打开 DevTools → Application → Session Storage
   - 删除 `duomotai_user_profile` 键（如果存在）
   - 删除 `server/UserInfo/13917895758_profile.json` 文件（如果存在）

2. **刷新页面**，登录测试账号 13917895758

3. **填写用户画像**：
   - 年龄段：`25-35`
   - 性别：`男`
   - 昵称：`测试用户张三`
   - 邮箱：`zhangsan@test.com`

4. **提交保存**

**预期结果**:

✅ **Session Storage 验证**:
- 打开 DevTools → Application → Session Storage
- 找到 `duomotai_user_profile` 键
- 值包含：
  ```json
  {
    "phone": "13917895758",
    "ageGroup": "25-35",
    "gender": "男",
    "nickname": "测试用户张三",
    "email": "zhangsan@test.com"
  }
  ```

✅ **后端文件验证**:
- 文件路径：`D:\_100W\rrxsxyz_next\server\UserInfo\13917895758_profile.json`
- 文件存在且包含上述 JSON 数据
- 文件格式正确（有效的 JSON）

✅ **Console 验证**:
- 查看浏览器 Console
- 应显示：`✅ 用户画像已保存`

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

### 测试点 1.3.2 - 画像数据读取

**功能位置**: 页面加载时自动读取
**代码位置**: `userProfile.js` init() 函数

#### 场景 A：从 Session Storage 读取

**步骤**:
1. **确认画像已存在**（使用测试点 1.3.1 创建的数据）

2. **刷新页面**（不清除缓存）

3. **查看 Console 日志**

**预期结果**:
- ✅ Console 显示：`✅ 用户画像已加载（缓存）: {phone: "13917895758", ...}`
- ✅ **不弹出调研模态框**（因为画像完整）
- ✅ 可直接启动辩论

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 B：从后端服务器读取

**步骤**:
1. **删除 Session Storage**：
   - DevTools → Application → Session Storage
   - 删除 `duomotai_user_profile` 键

2. **保留后端文件**：
   - 确认 `server/UserInfo/13917895758_profile.json` 存在

3. **刷新页面**

**预期结果**:
- ✅ Console 显示：`✅ 用户画像已加载（服务器）: {phone: "13917895758", ...}`
- ✅ Session Storage 自动恢复（从服务器同步）
- ✅ 不弹出调研模态框

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 C：画像不存在时的降级

**步骤**:
1. **删除所有画像数据**：
   - 删除 Session Storage 中的 `duomotai_user_profile`
   - 删除后端文件 `server/UserInfo/13917895758_profile.json`

2. **刷新页面**

**预期结果**:
- ✅ Console 显示：`📋 用户画像不完整，需要填写调研`
- ✅ **自动弹出调研模态框**
- ✅ 无法启动辩论（直到填写完整）

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

### 测试点 1.3.3 - 画像更新

**功能位置**: 用户画像编辑功能
**代码位置**: `userProfile.js` + 后端 API

#### 场景 A：修改昵称

**步骤**:
1. **确认画像已存在**（昵称：`测试用户张三`）

2. **重新打开调研模态框**（如果有编辑按钮，点击；否则清除缓存重新登录）

3. **修改昵称**：
   - 原值：`测试用户张三`
   - 新值：`李四用户测试`

4. **保存**

**预期结果**:
- ✅ Session Storage 更新：`nickname: "李四用户测试"`
- ✅ 后端文件更新：`13917895758_profile.json` 包含新昵称
- ✅ 其他字段保持不变（年龄段、性别、邮箱）

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 B：修改邮箱

**步骤**:
1. **修改邮箱**：
   - 原值：`zhangsan@test.com`
   - 新值：`lisi@example.org`

2. **保存**

**预期结果**:
- ✅ Session Storage 更新
- ✅ 后端文件更新
- ✅ 邮箱格式验证生效（如果输入非法格式，应拒绝）

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

#### 场景 C：部分字段更新（增量更新）

**步骤**:
1. **仅修改性别**：
   - 原值：`男`
   - 新值：`女`

2. **其他字段不修改**

3. **保存**

**预期结果**:
- ✅ 性别更新：`"gender": "女"`
- ✅ **其他字段完整保留**（昵称、邮箱、年龄段等）
- ✅ 后端文件结构完整，无数据丢失

**实际结果**: _____________

**是否通过**: ⬜ 通过 / ⬜ 失败

---

## 📊 测试结果汇总

### Module 1.2 - 数据验证

| 测试点 | 场景数 | 通过 | 失败 | 通过率 |
|--------|-------|------|------|--------|
| 1.2.1 话题长度验证 | 4 | ___ | ___ | ___% |
| 1.2.2 邮箱格式验证 | 2 | ___ | ___ | ___% |
| 1.2.3 XSS 防护 | 4 | ___ | ___ | ___% |
| 1.2.4 SQL 注入防护 | 2 | ___ | ___ | ___% |
| **总计** | **12** | ___ | ___ | ___% |

### Module 1.3 - 用户画像

| 测试点 | 场景数 | 通过 | 失败 | 通过率 |
|--------|-------|------|------|--------|
| 1.3.1 画像数据存储 | 1 | ___ | ___ | ___% |
| 1.3.2 画像数据读取 | 3 | ___ | ___ | ___% |
| 1.3.3 画像更新 | 3 | ___ | ___ | ___% |
| **总计** | **7** | ___ | ___ | ___% |

### 总体测试结果

- **总测试场景数**: 19
- **通过场景数**: ___
- **失败场景数**: ___
- **通过率**: ___%

**测试结论**: ⬜ 全部通过 / ⬜ 部分通过 / ⬜ 未通过

---

## 🐛 问题记录

**如果测试失败，请记录详细信息**：

### 问题 1

- **测试点**: ___________
- **场景**: ___________
- **预期结果**: ___________
- **实际结果**: ___________
- **错误截图**: ___________
- **优先级**: ⬜ P0 / ⬜ P1 / ⬜ P2

### 问题 2

（如有更多问题，请继续添加）

---

## ✅ 测试完成确认

**测试人**: ___________
**测试日期**: 2025-10-18
**测试耗时**: _____ 分钟
**是否创建备份**: ⬜ 是 / ⬜ 否

**备份命令**（测试通过后执行）：
```powershell
# Module 1.2 通过
.\scripts\ModuleBackup.ps1 -ModuleTag "M1.2_DataValidator" -Description "数据验证子模块验证通过"

# Module 1.3 通过
.\scripts\ModuleBackup.ps1 -ModuleTag "M1.3_UserProfile" -Description "用户画像子模块验证通过"

# Module 1 全部通过
.\scripts\ModuleBackup.ps1 -ModuleTag "M1_COMPLETE" -Description "Module 1 完整验证通过"
```

---

**End of Test Guide**
