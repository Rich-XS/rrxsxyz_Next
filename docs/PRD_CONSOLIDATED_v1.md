# 多魔汰风暴辩论系统 - 完整 PRD 清单 v1.0

**创建时间**: 2025-10-28 12:30 (GMT+8)
**文档状态**: Night-Auth 期间自动生成
**数据来源**: ideas.md (L1-L1184)
**当前版本**: V57.10

---

## 📋 优先级分类说明

- **P0 (Critical)**: 阻塞性问题，影响核心功能，必须立即解决
- **P1 (High)**: 重要功能缺失或体验问题，需要尽快解决
- **P2 (Medium)**: 体验优化，可以延后但需要规划
- **P3 (Low)**: 未来考虑，不紧急

---

## 🔥 P0 - 阻塞性问题（Core Blockers）

### P0-1: 策划阶段文字流延迟问题
**来源**: ideas.md L1068-1069, L1079-1080
**问题描述**: 策划阶段文字显示延迟 8-15 秒，非流式输出
**当前状态**: V57.10 仍未解决
**预期行为**: < 3 秒开始逐字显示
**相关文件**: debateEngine.js, aiCaller.js
**验收标准**: Console 显示 "[V57.10 节流emit]" + 文字实时显示

### P0-2: 委托人补充在 AI 提示词中高权重体现
**来源**: ideas.md L1006
**问题描述**: 委托人补充后，专家发言未明显承接补充内容
**预期行为**: 后续专家发言包含 "结合委托人提出的'XXX'补充..."
**设计方案**:
- 委托人最近 2-3 次补充内容权重提升
- 在 AI 提示词中明确标记【委托人重点关注】
**验收标准**: 测试补充 "务必落地"，下一位专家发言明确回应该要点

### P0-3: 专家发言间隔时间过长
**来源**: ideas.md L842, L929, L1012
**问题描述**: 专家间隔 8-10 秒，严重影响体验
**根因分析**: 后端已收到数据，但前端流式输出严重滞后
**目标**: 控制在 2-3 秒
**验收标准**: Console 日志显示数据接收 → 前端显示 < 3 秒

---

## 🚀 P1 - 高优先级功能（High Priority Features）

### P1-1: 风暴辩论流程规范化
**来源**: ideas.md L234-249
**核心流程定义**:
```
每轮标准流程：
1. 领袖: 轮开场 → 询问委托人'开场补充'
2. 委托人: 开场补充
3. 领袖: 上半轮开场 → 宣布'轮流发言'
4. 各专家: 轮流发言
5. 领袖: 上半轮小结（承上） → 邀请委托人补充
6. 委托人: 中场补充
7. 领袖: 中场转场（启下） → 宣布'补充发言'
8. 各专家: 补充发言
9. 领袖: 预总结 → 邀请委托人'本轮补充'
10. 委托人: 本轮补充
11. 领袖: 本轮最终总结 → 宣布进入下一环节
```
**当前问题**:
- 第 2 轮出现 3 次总结（ideas.md L973）
- "承上" 和 "启下" 时机不准确（ideas.md L843）
**验收标准**: 11 步流程完整，无遗漏无重复

### P1-2: 字数控制参数优化
**来源**: ideas.md L251-271, L799-800
**当前策略**:
- 测试用户 0.5x（字数减半）
- 真实用户 0.8x（建议值）
**实际测试结果** (V56.x):
- 领袖策划: 799-963 字（目标 400-800）
- 领袖开场: 617-649 字（目标 400）
- 专家发言: 200-342 字（目标 200-250）
**建议调整**:
- 测试用户: 保持 0.5x
- 真实用户: 调整为 0.6x-0.7x（避免过长）
**验收标准**: 95% 的发言字数在目标范围内

### P1-3: 男女语音个性化
**来源**: ideas.md L844, L1014
**需求**:
- 男角色使用男声（Elon, Donald, Zeus, Mark, Jack, Rick, Jason, Liam, Owen）
- 女角色使用女声（Jane, Chloe, Clara, Eve, Mary, Joy, Victoria）
- 委托人声音根据 profile 选定（稳重活力 40 岁左右）
**当前状态**: V57.x 有性别识别代码，但未生效
**验收标准**: 测试用户登录，听到 Elon 是男声，Jane 是女声

### P1-4: 委托人补充视觉增强
**来源**: ideas.md L1004, L1041
**当前效果**: 金边 + 暖白背景
**用户反馈**: 不够凸显，需要更明显
**改进方案**:
- 边框: 8px + 金色阴影
- 背景: 更鲜艳橙色（#FFF4E6 → #FFE4B5）
- 前缀: 【委托人重要补充】（红色粗体）
- 与专家发言背景色明显区分
**验收标准**: 用户测试反馈 "补充内容非常明显"

### P1-5: 轮次间停顿优化
**来源**: ideas.md L845
**需求**: 第一轮结束 → 第二轮开始前，显示 2 秒停顿提示
**当前状态**: V57.0 已实现
**验收标准**: 轮次间显示 "⏱️ 准备进入下一轮..." + 2 秒倒计时

---

## 🔧 P2 - 中优先级优化（Medium Priority）

### P2-1: 颜色方案用户测试
**来源**: ideas.md L979, L1008, L1042
**待测试方案**:
- Plan A (当前): 蓝色#007AFF + 橙色#FF9500
- Plan B (高对比): 亮红#FF3B30 + 亮绿#30D158
- Plan C (待设计): 紫色 + 绿色系列
**用户反馈**: Plan A 橙色标题字体可以再大些
**验收标准**: 用户选定最终方案 → 固化到 CLAUDE.md

### P2-2: 角色显示优化
**来源**: ideas.md L987
**当前**: 领袖显示 "Victoria"，专家显示 "行业专家"
**改进**: 统一显示为 "角色+名字"
**示例**:
- "领袖 (Victoria)"
- "第一性原则 (Elon)"
- "行业专家 (Jane)"
**验收标准**: 所有角色显示格式统一

### P2-3: 专家发言前缀优化
**来源**: ideas.md L988, L999
**问题**: 第 2 轮开始，专家每次都说 "作为 XXX"
**改进**: 仅首轮使用 "作为 XXX"，后续轮次改为：
- "基于之前讨论..."
- "我补充一点..."
- "从 XXX 视角来看..."
**验收标准**: 第 2-3 轮专家发言，< 20% 使用 "作为 XXX" 前缀

### P2-4: 策划阶段补充显示问题
**来源**: ideas.md L1019, L1044
**问题**: 策划时委托人补充，有语音无文字流
**预期**: 补充提交后，10 秒内显示补充内容 + 语音朗读
**验收标准**: 测试提交 "改 5 轮"，看到文字显示 + 听到语音

### P2-5: 发言内容递进性优化
**来源**: ideas.md L293-294
**核心要求**: 专家发言必须基于之前轮次和本轮已发言内容
**设计方案**:
- contextDatabase 记录所有发言要点
- AI 提示词包含 "基于之前 XXX 的观点..."
- 避免重复相同论点
**验收标准**: 手动检查 3 轮辩论，专家发言无明显重复

---

## 🎨 P3 - 低优先级优化（Low Priority）

### P3-1: 底部按钮悬浮窗 UI
**来源**: ideas.md L990, L1017
**需求**:
- 顶部 Banner 悬浮（5 秒非活跃后隐藏）
- 底部按钮栏悬浮（打断/补充/确认始终可见）
**原因**: 多专家发言时，委托人可能需要仔细阅读内容
**验收标准**: 专家发言时，滚动页面，底部按钮始终可见

### P3-2: 文字速度调节功能实现
**来源**: ideas.md L275-276, L417
**UI 已完成**: V55.x 已添加 "文字速度调节" 开关
**逻辑未实现**: 调节不影响实际文字流速度
**目标**:
- 默认 5.0x（对应 10 字/秒）
- 范围 1x~10x（对应 2 字/秒~20 字/秒）
**验收标准**: 调节速度后，文字流明显变快/变慢

### P3-3: 表情符号智能过滤
**来源**: ideas.md L851, L920
**问题**: AI 生成内容包含 ✨ 等符号，语音会读出 "星号"
**当前状态**: D-94 已禁止表情符号
**验收标准**: 任何环节无表情符号出现

---

## 🐛 已知 Bug 列表

### Bug #1: 策划轮次数解析错误
**来源**: ideas.md L984
**问题描述**: 用户选择 3 轮，实际进行 4 轮（第 4 轮只有领袖总结）
**优先级**: P1
**相关文件**: debateEngine.js 轮次解析逻辑
**验收标准**: 选择 N 轮，实际进行 N 轮

### Bug #2: 第 2 轮出现 3 次总结
**来源**: ideas.md L973
**问题描述**: 第 2 轮领袖出现 pre + FINAL + 额外总结
**优先级**: P1
**相关文件**: debateEngine.js runRound()
**验收标准**: 每轮只有 1 次预总结 + 1 次最终总结

### Bug #3: 角色卡显示数量错误
**来源**: ideas.md L676-677, L777
**问题描述**: 测试用户选 2 个角色，底部显示 "已选择 8 个角色"
**优先级**: P1
**相关文件**: init.js 角色选择逻辑
**验收标准**: 选 N 个角色，显示 "已选择 N 个角色"

### Bug #4: 策划内容专家数量错误
**来源**: ideas.md L677
**问题描述**: 策划内容显示 8 个专家，而非实际选择的 2 个
**优先级**: P1
**相关文件**: debateEngine.js 策划阶段 AI 提示词
**验收标准**: 策划内容仅提及实际选中的专家

---

## 📖 关联文档

### 核心设计文档
- **Design_Spec_v2.1.md**: ideas.md L164-199 定义的流程规范
- **duomotai_product_features_v13.md**: ideas.md L296 提到的产品功能细则
- **CLAUDE.md**: D-87/D-84/D-76 等核心决策

### 历史版本参考
- **V54**: `D:\_100W\rrxsxyz_next_20251023_2317_V54_GembaTest.zip`（ideas.md L592）
- **V55 系列**: 字数控制优化、TextContent 性能优化
- **V56 系列**: 字数倍数参数化（0.5x/0.8x）
- **V57 系列**: 中场流程重构、男女语音、视觉优化

---

## 🎯 验收标准总结

### 核心功能验收清单（必须 100% 通过）
- [ ] 策划阶段文字流 < 3 秒开始显示
- [ ] 专家发言间隔 < 3 秒
- [ ] 委托人补充后，下一位专家明确回应
- [ ] 11 步流程完整无遗漏
- [ ] 字数控制 95% 在目标范围
- [ ] 男女语音区分明显
- [ ] 轮次数量准确（选 N 轮 = 实际 N 轮）

### 体验优化验收清单（建议 80% 通过）
- [ ] 委托人补充视觉明显
- [ ] 轮次间停顿自然（2 秒）
- [ ] 角色显示格式统一
- [ ] 专家发言无重复前缀
- [ ] 颜色方案用户满意
- [ ] 无表情符号干扰

---

## 📌 待确认问题（需要用户明确）

### Q1: 中场转场流程时机
**来源**: ideas.md L740, L843
**问题**: "承上启下" 应该分开还是合并？
**选项**:
- A. 分开：承上（委托人补充前） + 启下（委托人补充后）
- B. 合并：承上启下（委托人补充后一次性完成）
**需要确认**: 用户选择 A 或 B

### Q2: 文字速度默认值
**来源**: ideas.md L416-417
**当前**: 默认 5.0x（对应约 10 字/秒）
**用户反馈**: V56.0 测试时感觉 "默认的 1.0x 仍然偏快"
**需要确认**: 是否调整为更慢的默认值（如 3.0x）

### Q3: 测试用户字数倍数最终值
**来源**: ideas.md L799-800
**当前**: 测试用户 0.5x，真实用户 0.8x
**用户建议**: 以当前字数为准，测试用户 0.5x，真实用户 0.8x
**需要确认**: 是否固化为最终参数

---

## 🔄 下一步行动计划

### Night-Auth 期间可自主完成
1. ✅ 提取 ideas.md 所有问题点（本文档）
2. ⏳ 对比 V54/V55 版本，识别退化功能点
3. ⏳ 改进 localhost_start.bat（端口检查）
4. ⏳ 完善 safe_port_cleanup.ps1

### 需要用户确认后执行
1. ⏳ 修复 P0-1: 策划文字流延迟
2. ⏳ 修复 P0-2: 委托人补充高权重
3. ⏳ 修复 P0-3: 专家间隔时间
4. ⏳ 修复 Bug #1-#4

---

**文档版本**: v1.0
**下次更新**: 用户测试反馈后
**维护责任**: progress-recorder agent (Night-Auth 期间)
