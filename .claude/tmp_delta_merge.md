## 增量合并内容（2025-10-19 01:05）

### 待添加到 Done 区块（紧急修复）

- [x] **紧急修复：多魔汰系统 AI 模型超时和降级循环问题** [2025-10-19 01:05]
  - **任务类型**: P0 紧急Bug修复
  - **问题描述**:
    - 所有 AI 模型（DeepSeek、AnyRouter、Gemini）都在 20 秒后超时
    - 系统陷入无限降级循环（失败次数达到 26+ 次）
    - 领袖策划和开场显示 fallback 消息："由于网络原因，我的观点暂时无法完整表达"
    - 专家发言字数过长，超出用户要求
  - **执行内容**:
    - ✅ 切换默认模型到 Qwen（debateEngine.js line 23）- Qwen 虽有小问题但不会超时
    - ✅ 增加 API 超时时间：所有模型从 20s → 60s（aiService.js）
    - ✅ 修复降级循环问题：
      - 添加 _retryCount 参数限制重试次数为 3
      - 修复重试计数器传递错误（必须放在 ...params 后面）
      - 添加调试日志追踪重试过程
    - ✅ 落实字数控制要求（debateEngine.js）:
      - 领袖策划：1600 tokens (400-800字)
      - 领袖第一轮开场：1600 tokens (400-800字)
      - 领袖其他轮开场：600 tokens (100-300字)
      - 领袖中场转场：800 tokens (200-400字)
      - 领袖本轮总结：1200 tokens (400-600字)
      - 专家发言：1000 tokens (300-500字)
  - **修改文件**:
    - duomotai/src/modules/debateEngine.js（字数控制）
    - server/services/aiService.js（超时和重试限制）
  - **状态**: ✅ 已完成，待用户测试验证
  - **关联任务**: 此修复基于 Phase 1 用户测试反馈

### 待添加到 Notes 区块（临时记录）

- [2025-10-19 01:05] ⚠️ AI 模型超时修复完成，关键配置变更：
  - 默认模型：DeepSeek → Qwen（临时解决方案，Qwen 更稳定但输出质量略低）
  - 超时配置：20s → 60s（所有模型）
  - 降级重试：添加最多 3 次限制
  - 字数控制：严格按 PRD 要求限制各角色发言长度
  - 需用户验证：是否接受 Qwen 作为默认模型？或继续调试 DeepSeek 超时问题？
